<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
<div class="header">
	<div class="container-fluid main-nav-shadow">
		<div class="row">
			<div class="col-md-2">
				<br /><br />
				<%= link_to root_path do %>
					<%= image_tag "app/logo1.png", class: "img-responsive" %>
				<% end %>
			</div>
			<div class="col-md-8 the-bar-width">
				<%= form_tag({ controller: :mains, action: :search }, :method => "get", id: "search-form") do %>
				<div class="row" align="center">
					<div class="col-md-2 col-sm-2 col-xs-12"></div>
					<div class="col-md-6 col-sm-6 col-xs-12">
						<%= text_field_tag :q, params[:q], placeholder: "Search" %>
					</div>
					<div class="col-md-2 col-sm-2 col-xs-12" align="center">
						<%= submit_tag "Search", class: "save-button color-orange" %>
					</div>
					<div class="col-md-2 col-sm-2 col-xs-12"></div>
				</div>
				<% end %>
			</div>	
			<div class="col-md-2">
				<br /><br />
				<ul class="card">
				<% if @profile.user.id == session[:user_id] %>
					<li><a href="/user/sign_out/"><i class="fa fa-user" aria-hidden="true"></i>Sign out</a></li>
					<% else %>
					<li><a href="/users/new/"><i class="fa fa-user" aria-hidden="true"></i>Login</a></li>
					<li><a href="/users/new/"><i class="fa fa-user" aria-hidden="true"></i>Sign Up</a></li>
				<% end %>
				</ul>
			</div>
		</div>
	<br />
	</div>
</div>


<div class="banner-profile">
<% if @profile.banner.url.nil? %>
	<%= image_tag "app/kwaku1.jpg", class: "custom-profile-banner" %>
<% else %>
	<%= image_tag @profile.banner.url, class: "custom-profile-banner" %>
<% end %>

	<ul class="rslides" id="slider" value="<%= @profile.id %>" >
		<li>
			<div class="banner-profile-info">
				<h3><%= @profile.name_of_agency %></h3>
				<p><%= @profile.tagline %></p>
				<br /><br /><br />
			</div>
		</li>
	</ul>
</div>




<div class="about-me" id="about" style="background-color: #f2f2f2;">
	<div class="container">
	<br /><br />
		<div class="row">
			<div class="col-md-3">
				<div class="mydetails slideanim text-center" style="padding: 0px;">
					<div style="background-color: rgba(175, 169, 164, 0.75); width: 100%; height: 100%; color: white;">
						<br /><br />
						<%= image_tag "app/man_profile.jpg", { class: "img-circle img-responsive img-border", alt: "Generic placeholder image", width: "200", height: "200" } %>
						<br /><br />
						<div class="row">
							<div class="col-md-4">
								<h4><b><%= @profile.user.reviews.size %></b></h4>
								<p><i class="fa fa-star" aria-hidden="true"></i></p>
							</div>
							<div class="col-md-4" style="border-left: 1px solid white; border-right: 1px solid white;">
								<h4><b><%= @profile.user.mail_box.messages.size %></b></h4>
								<p><i class="fa fa-comments" aria-hidden="true"></i></p>
							</div>
							<div class="col-md-4">
								<h4><b><%= @profile.services.size %></b></h4>
								<p><i class="fa fa-list" aria-hidden="true"></i></p>
							</div>
						</div>
						<br /><br />
						<div>
						<% if @profile.user.id == session[:user_id] %>
							<button class="the-edit-button" onclick="window.location.href='/users/new/'">Edit Profile</button>
						<% end %>
						</div>
						<br /><br />
					</div>
					<div>
						<h3>WHO WE ARE</h3>
						<div style="padding: 0em 2em 0em 2em;">
							<p class="short_desc_text"><%= @profile.short_desc %></p>
						</div>
						<br />
						<div>
							<h3>WHAT WE DO</h3>
                        	<div class="footer-info">
								<div style="padding: 0em 2em 0em 2em;">
									<p><%= @profile.desc %> </p>
								</div>
								<br />
								<br /><br />
							</div>
						</div>
					</div>
				</div>
			</div>
			<% if flash[:error].nil? && !flash[:notice].nil? %>
				<%= display_service_posted_success flash[:notice] %>
			<% else %>
				<%= display_errors flash[:error] %>
			<% end %>
			<div class="col-md-9" style="background-color: #fff;padding: 0;">

				<div class="navigation-div">
					<ul class="nav nav-tabs">
					<% if @profile.user.id == session[:user_id] %>
						<li class="active"><a data-toggle="tab" href="#home">New Listing</a></li>
						<li><a data-toggle="tab" href="#menu1">Mailbox</a></li>
					<% end %>
						<li><a data-toggle="tab" href="#menu3">Listings</a></li>
    					
  					</ul>
  				</div>
  				<br /><br />
  				<div class="tab-content" align="center">
				  <% if @profile.user.id == session[:user_id] %>
  					<div id="home" class="tab-pane fade in active from-prof">
      					<div class="myskills slideanim">
							<h3 class="text-center">Post a Listing</h3>
							<%= form_for @service, url: { controller: :services, action: :create, profile: @profile.id } do |f| %>
                    		<table class="table table-striped">
                    			<tr>
                    				<td><p>Your service type</p></td>
                    				<td style="vertical-align: middle;">
										<%= f.select :category_id, @categories.map {|c| [c.name, c.id]}, {}, {required: 'true', autofocus: 'true', class: 'form-control'} %>
									</td>
								</tr>
								<tr>
                    				<!--<td><p>Your service sub-category</p></td>
                    				<td style="vertical-align: middle;">
										 sub-categories should be here and from database 
									</td>-->
								</tr>
								<tr>
                    				<td><p>Name of Product or Service</p></td>
                    				<td style="vertical-align: middle;">
										<!-- name of product should be a form input textbox -->
										<%= f.text_field :name_of_service, { placeholder: "Name" , class: "form-control", required: 'true' } %>
									</td>
								</tr>
								<tr>
									<td><p>Please upload a picture of your product</p></td>
									<td style="vertical-align: middle;">
										<%= f.file_field :picture, { class: "form-control", required: 'true' } %>
									</td>
									<p> * Picture file size must be less than or equal to 2 MB </p>
								</tr>
								<tr>
									<td><p>Description of the product or service</p></td>
									<td style="vertical-align: middle;">
										<%= f.text_area :desc_service, { rows:"10", cols:"31", placeholder: "Service Description", class:"form-control", required: 'true' } %>
									</td>
								</tr>
								<tr>
									<td><p>Minimal Price</p></td>
									<td style="vertical-align: middle;">
										<%= f.text_field :price, { placeholder: "Price", class: "form-control", required: 'true' } %>	
									</td>
								</tr>
								<tr>
									<td><p>Metric</p></td>
									<td style="vertical-align: middle;">
										<%= f.text_field :metric, { placeholder: "Eg. Per Kg", class: "form-control", required: 'true' } %>	
									</td>
								</tr>
								<tr>
									<td colspan="2" align="center">	
										<%= f.submit "Submit", class: "btn btn-success save-button" %>
									</td>
								</tr>
								<% end %>
							</table>
						</div>
    				</div>
					<% end %>
					<% if @profile.user.id == session[:user_id] %>
    					<div id="menu3" class="tab-pane fade">
					<% else %>
						<div id="menu3" class="tab-pane fade in active from-prof">
					<% end %>
					
						<div class="myskills slideanim move-down">
							<% if @services.blank? %>
								<h3 class="text-center">No Listings</h3>
								<hr style="margin:0;">
								<p class="text-center">When listings are posted, they will appear here.</p>
							<% else %>
								<% @services.each do |service| %>
									<div class="col-md-4">
										<%= image_tag service.picture.small.url %>
									</div>
								<% end %>
										
							<% end %>
						</div>
    				</div>
    				<div id="menu1" class="tab-pane fade"><!-- Please put "no mesages yet" if there are no messages so that it won't be blank just like that -->
      					<div class="myskills slideanim">
							<div class="row">
  								<div class="panel-group" id="accordion">
								  <% @mail_box.each do |message| %>
    								<div class="panel panel-default">
      									<div class="panel-heading">
        									<h4 class="panel-title">
          										<a class="message-mail" title="<%= message.id %>" data-toggle="collapse" data-parent="#accordion" href="#collapse<%= message.id %>"><%= message.sender.name %></a>
        									</h4>
      									</div>
      									<div id="collapse<%= message.id %>" class="panel-collapse collapse">
        									<div class="panel-body">
											<% unless message.service.nil? %>
												<p><%= message.sender.name %> wrote to you about <%= message.service.name_of_service %> which you posted on <%= message.service.created_at.strftime("%d %B %Y") %> in the <%= message.service.category.name %> category </p>
											<% end %>
        										<%=  message.body %>
        										<br /><br />
        										<a href="#replyModal<%= message.id %>" class="messaging-body" data-toggle="modal">Reply</a>
        									</div>
      									</div>
    								</div>
									<% end %>
  								</div> 
							</div>
						</div>
    				</div>
  				</div>
			</div>	
			</div>
		</div>
	</div>
	<div class="bottom-div">
		<br />
	</div>
</div>

<% @mail_box.each do |message| %>
<div class="container">
	<div class="modal fade rplymd" id="replyModal<%= message.id %>" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header the-modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<%= image_tag "app/logo1.png", class: "img-head" %>
					<br /><br /><br />
					<h3 class="modal-title"><%= message.body %> </h3>
				</div>
				<div class="modal-body md-body" align="center">
					<textarea id="body" row="10" col="10"></textarea>
					<p class="sender-this" style="display: none;"><%= message.sender.profile.id %></p>
					<input id="service-this" type="hidden" name="service" value="<%= message.service_id %>">
					<br /><br /><br />
				</div>
				<div class="modal-footer the-modal-footer">
					<button id="message-supplier">Reply</button>	
				</div>
			</div>
		</div>
	</div>
</div>
<% end %>
